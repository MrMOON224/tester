<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events - School</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        school: {
                            navy: '#0F172A',
                            gold: '#D4AF37',
                            cream: '#F9FAFB',
                            blue: '#1E40AF'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Merriweather', 'serif'],
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-school-cream text-slate-800 antialiased flex flex-col min-h-screen">

    <!-- Navbar -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <a href="index.html" class="flex items-center gap-3 group">
                    <div
                        class="w-10 h-10 bg-school-navy text-school-gold flex items-center justify-center rounded-lg font-serif font-bold text-2xl group-hover:bg-school-gold group-hover:text-school-navy transition">
                        S</div>
                    <div>
                        <h1 class="text-xl font-bold text-school-navy font-serif leading-none">School</h1>
                        <p class="text-[10px] text-slate-500 uppercase tracking-widest">Est. 2026</p>
                    </div>
                </a>
                <a href="index.html" class="text-sm font-semibold text-slate-500 hover:text-school-blue transition"><i
                        class="fas fa-arrow-left mr-2"></i> Back to Home</a>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <header class="bg-school-navy text-white py-16 relative overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 relative z-10 text-center">
            <p class="text-school-gold font-bold tracking-widest uppercase text-sm mb-4">Campus Life</p>
            <h1 class="text-4xl md:text-5xl font-serif font-bold mb-4">Upcoming Events</h1>
            <p class="text-slate-300 max-w-2xl mx-auto font-light">Join us in celebrating our students' achievements and
                community gatherings.</p>
        </div>
        <div class="absolute inset-0 opacity-10"
            style="background-image: url('https://www.transparenttextures.com/patterns/cubes.png');"></div>
    </header>

    <!-- Content -->
    <main class="flex-grow py-16">
        <div class="max-w-7xl mx-auto px-4" id="events-container">
            <!-- Loading -->
            <div class="text-center py-12">
                <i class="fas fa-circle-notch fa-spin text-3xl text-school-gold mb-4"></i>
                <p class="text-slate-500">Loading events...</p>
            </div>
        </div>
    </main>

    <!-- Full Screen Detail View -->
    <div id="detail-view"
        class="fixed inset-0 z-[100] bg-white transform translate-x-full transition-transform duration-300 overflow-y-auto flex flex-col">
        <!-- Sticky Header -->
        <div
            class="sticky top-0 bg-white/95 backdrop-blur border-b border-slate-100 px-4 py-3 flex items-center shadow-sm z-50">
            <button onclick="closeDetail()"
                class="flex items-center text-slate-600 font-bold hover:text-school-navy transition">
                <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center mr-2"><i
                        class="fas fa-arrow-left"></i></div>
                Back
            </button>
            <span class="ml-auto text-xs font-bold text-school-gold uppercase tracking-widest">Event Details</span>
        </div>

        <div class="flex-grow flex flex-col md:flex-row">
            <!-- Media Section (Top/Left) -->
            <div class="w-full md:w-1/2 bg-black min-h-[300px] md:min-h-0 md:h-auto sticky md:top-14"
                id="detail-media-wrapper">
                <div id="detail-media" class="w-full h-full flex items-center justify-center p-4"></div>
            </div>

            <!-- Content Section (Bottom/Right) -->
            <div class="w-full md:w-1/2 p-6 md:p-12 pb-20">
                <div class="mb-6">
                    <span id="detail-date"
                        class="bg-school-gold text-school-navy text-xs font-bold px-3 py-1 rounded uppercase tracking-wide">Date</span>
                    <h2 id="detail-title"
                        class="text-3xl md:text-4xl font-serif font-bold text-school-navy mt-4 leading-tight">Title</h2>
                    <p id="detail-loc" class="text-school-blue font-bold text-sm mt-3 flex items-center"><i
                            class="fas fa-map-marker-alt mr-2"></i> Location</p>
                </div>

                <div id="detail-desc"
                    class="prose prose-slate max-w-none text-slate-600 mb-10 leading-relaxed whitespace-pre-line">
                    Description...
                </div>

                <h4 class="text-xs font-bold uppercase text-slate-400 mb-4 tracking-wider">Location Map</h4>
                <!-- Google Map Container -->
                <div id="detail-map"
                    class="w-full h-64 rounded-xl overflow-hidden bg-slate-100 border border-slate-200 hidden shadow-sm">
                </div>
                <a id="detail-map-link" href="#" target="_blank"
                    class="hidden block w-full text-center py-4 border-2 border-school-navy text-school-navy font-bold rounded-lg hover:bg-school-navy hover:text-white transition">OPEN
                    IN GOOGLE MAPS</a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 py-8 text-center text-slate-500 text-sm">
        <p>&copy; 2026 School. All Rights Reserved.</p>
    </footer>

    <!-- Logic -->
    <script type="module">
        import { supabase } from './assets/js/supabase-client.js';

        let allEvents = [];

        async function loadEvents() {
            const container = document.getElementById('events-container');
            const { data, error } = await supabase.from('events').select('*').order('event_date', { ascending: true });

            if (error) {
                container.innerHTML = `<div class="p-8 bg-red-50 text-red-600 rounded text-center">Error loading events.</div>`;
                return;
            }

            if (!data || data.length === 0) {
                container.innerHTML = `<div class="p-12 bg-white rounded shadow-sm text-center text-slate-500">No upcoming events scheduled.</div>`;
                return;
            }

            allEvents = data;

            container.innerHTML = `<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                ${data.map((e, index) => `
                    <div class="bg-white rounded-xl overflow-hidden shadow-sm border border-slate-100 hover:shadow-md transition group cursor-pointer transform hover:-translate-y-1" onclick="openEvent(${index})">
                        <div class="h-56 relative bg-slate-900">
                             ${e.image_url?.match(/\.(mp4|webm)$/i)
                    ? `<video src="${e.image_url}" class="w-full h-full object-cover pointer-events-none"></video>`
                    : `<img src="${e.image_url || 'https://placehold.co/600x400'}" class="w-full h-full object-cover group-hover:scale-105 transition duration-700 opacity-90 group-hover:opacity-100">`
                }
                             <!-- Date Badge -->
                             <div class="absolute top-4 left-4 bg-white text-school-navy rounded-lg p-2 text-center min-w-[60px] shadow-lg">
                                <span class="block text-xs font-bold uppercase text-slate-400">${new Date(e.event_date).toLocaleString('default', { month: 'short' })}</span>
                                <span class="block text-xl font-bold font-serif leading-none">${new Date(e.event_date).getDate()}</span>
                             </div>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-school-navy mb-2 font-serif line-clamp-1 group-hover:text-school-blue transition">${e.title}</h3>
                            <div class="flex items-center text-sm text-school-gold font-bold uppercase tracking-wide mb-4">
                                <i class="fas fa-map-marker-alt mr-2"></i> ${e.location || 'Campus'}
                            </div>
                            <p class="text-slate-600 line-clamp-3 text-sm leading-relaxed">${e.description || ''}</p>
                            <span class="inline-block mt-4 text-xs font-bold text-slate-400 border-b border-transparent group-hover:border-school-gold group-hover:text-school-gold transition">View Details</span>
                        </div>
                    </div>
                `).join('')}
            </div>`;
        }

        // Full Screen Logic
        window.openEvent = (index) => {
            const evt = allEvents[index];
            const modal = document.getElementById('detail-view');

            // Text Data
            document.getElementById('detail-title').textContent = evt.title;
            document.getElementById('detail-desc').textContent = evt.description;
            // Handle potentially invalid/null date gracefully
            try {
                const dateObj = new Date(evt.event_date);
                document.getElementById('detail-date').textContent = dateObj.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            } catch (e) {
                document.getElementById('detail-date').textContent = evt.event_date;
            }

            document.getElementById('detail-loc').innerHTML = `<i class="fas fa-map-marker-alt mr-2"></i> ${evt.location || 'Campus'}`;

            // Media
            const mediaContainer = document.getElementById('detail-media');
            if (evt.image_url && evt.image_url.match(/\.(mp4|webm)$/i)) {
                mediaContainer.innerHTML = `<video src="${evt.image_url}" class="w-full h-full object-contain bg-black" controls autoplay></video>`;
            } else {
                mediaContainer.innerHTML = `<img src="${evt.image_url || 'https://placehold.co/800x600'}" class="w-full h-full object-contain">`;
            }

            // Map
            const mapContainer = document.getElementById('detail-map');
            const mapLink = document.getElementById('detail-map-link');
            const mapInput = evt.map_url || '';
            const isEmbed = mapInput.includes('<iframe');
            const isLink = mapInput.startsWith('http');

            if (isEmbed) {
                mapContainer.innerHTML = mapInput;
                const iframe = mapContainer.querySelector('iframe');
                if (iframe) { iframe.style.width = '100%'; iframe.style.height = '100%'; iframe.style.border = 'none'; }
                mapContainer.classList.remove('hidden');
                mapLink.classList.add('hidden');
            } else if (isLink) {
                mapContainer.classList.add('hidden');
                mapLink.href = mapInput;
                mapLink.classList.remove('hidden');
            } else {
                mapContainer.classList.add('hidden');
                mapLink.classList.add('hidden');
            }

            modal.classList.remove('translate-x-full');
            document.body.style.overflow = 'hidden';
        };

        window.closeDetail = () => {
            const modal = document.getElementById('detail-view');
            // Pause video
            const video = document.getElementById('detail-media').querySelector('video');
            if (video) video.pause();

            modal.classList.add('translate-x-full');
            document.body.style.overflow = '';
        };

        loadEvents();
    </script>
</body>

</html>